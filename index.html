<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API - api2-beta-app.vercel.app/proxy</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        h1 { color: #4CAF50; }
        .test-box {
            background: #2d2d2d;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }
        .error { border-left-color: #f44336; }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover { background: #45a049; }
        pre {
            background: #000;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 3px;
            margin-left: 10px;
            font-size: 12px;
        }
        .success { background: #4CAF50; }
        .failed { background: #f44336; }
        .loading { background: #ff9800; }
        .url { 
            background: #1e3a5f; 
            padding: 10px; 
            border-radius: 5px; 
            margin: 10px 0;
            word-break: break-all;
            font-size: 11px;
        }
    </style>
</head>
<body>
    <h1>üß™ Test API: api2-beta-app.vercel.app/proxy</h1>
    
    <div style="margin: 20px 0;">
        <button onclick="test1()">Test 1: Districts (C·∫ßn Th∆°)</button>
        <button onclick="test2()">Test 2: Wards (C·ªù ƒê·ªè)</button>
        <button onclick="test3()">Test 3: Convert Old‚ÜíNew</button>
        <button onclick="test4()">Test 4: New Wards (Ngh·ªá An)</button>
        <button onclick="test5()">Test 5: Convert New‚ÜíOld</button>
        <button onclick="runAll()" style="background: #2196F3;">üöÄ Run All</button>
    </div>

    <div id="results"></div>

    <script>
        const API = 'https://api2-beta-app.vercel.app/api/proxy';
        
        function log(title, status, data, url) {
            const div = document.createElement('div');
            div.className = 'test-box' + (status === 'error' ? ' error' : '');
            
            const badge = status === 'loading' ? 'loading' : (status === 'error' ? 'failed' : 'success');
            const icon = status === 'loading' ? '‚è≥' : (status === 'error' ? '‚ùå' : '‚úÖ');
            
            div.innerHTML = `
                <h3>${title} <span class="status ${badge}">${icon} ${status.toUpperCase()}</span></h3>
                ${url ? `<div class="url">URL: ${url}</div>` : ''}
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
            
            document.getElementById('results').insertBefore(div, document.getElementById('results').firstChild);
        }

        async function callAPI(params) {
            const qs = new URLSearchParams(params).toString();
            const url = `${API}?${qs}`;
            
            console.log('Calling:', url);
            
            try {
                const res = await fetch(url);
                const data = await res.json();
                
                if (!res.ok) {
                    throw new Error(`HTTP ${res.status}: ${JSON.stringify(data)}`);
                }
                
                return { success: true, data, status: res.status, url };
            } catch (error) {
                return { success: false, error: error.message, url };
            }
        }

        async function test1() {
            log('Test 1: Get Districts', 'loading', {});
            const result = await callAPI({
                action: 'districts',
                province_name: 'Th√†nh ph·ªë C·∫ßn Th∆°'
            });
            log('Test 1: Get Districts', result.success ? 'success' : 'error', 
                result.data || { error: result.error }, result.url);
        }

        async function test2() {
            log('Test 2: Get Wards', 'loading', {});
            const result = await callAPI({
                action: 'wards',
                district_name: 'Huy·ªán C·ªù ƒê·ªè',
                province_name: 'Th√†nh ph·ªë C·∫ßn Th∆°'
            });
            log('Test 2: Get Wards', result.success ? 'success' : 'error', 
                result.data || { error: result.error }, result.url);
        }

        async function test3() {
            log('Test 3: Convert Old‚ÜíNew', 'loading', {});
            const result = await callAPI({
                action: 'convert',
                old_ward_name: 'X√£ Trung An',
                old_district_name: 'Huy·ªán C·ªù ƒê·ªè',
                old_province_name: 'Th√†nh ph·ªë C·∫ßn Th∆°'
            });
            log('Test 3: Convert Old‚ÜíNew', result.success ? 'success' : 'error', 
                result.data || { error: result.error }, result.url);
        }

        async function test4() {
            log('Test 4: Get New Wards', 'loading', {});
            const result = await callAPI({
                action: 'new_wards',
                province_name: 'Ngh·ªá An'
            });
            log('Test 4: Get New Wards', result.success ? 'success' : 'error', 
                result.data || { error: result.error }, result.url);
        }

        async function test5() {
            log('Test 5: Convert New‚ÜíOld', 'loading', {});
            const result = await callAPI({
                action: 'convert-reverse',
                new_ward_name: 'Ph∆∞·ªùng T√¢y Hi·∫øu',
                new_province_name: 'Ngh·ªá An'
            });
            log('Test 5: Convert New‚ÜíOld', result.success ? 'success' : 'error', 
                result.data || { error: result.error }, result.url);
        }

        async function runAll() {
            document.getElementById('results').innerHTML = '';
            await test1();
            await new Promise(r => setTimeout(r, 500));
            await test2();
            await new Promise(r => setTimeout(r, 500));
            await test3();
            await new Promise(r => setTimeout(r, 500));
            await test4();
            await new Promise(r => setTimeout(r, 500));
            await test5();
        }

        // Auto run on load
        window.onload = () => {
            console.log('API Endpoint:', API);
            console.log('Ready to test!');
        };
    </script>
</body>
</html>
